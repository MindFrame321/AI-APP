<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focufy Settings</title>
  <link rel="stylesheet" href="settings.css">
</head>
<body>
  <div class="container">
    <header>
      <div class="header-content">
        <div class="logo">
          <svg width="40" height="40" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="64" cy="64" r="60" fill="url(#gradient)"/>
            <circle cx="64" cy="64" r="45" stroke="white" stroke-width="3" fill="none" opacity="0.3"/>
            <circle cx="64" cy="64" r="30" stroke="white" stroke-width="3" fill="none" opacity="0.5"/>
            <circle cx="64" cy="64" r="15" fill="white"/>
            <path d="M 45 35 L 45 75 L 55 75 L 55 55 L 70 55 L 70 45 L 55 45 L 55 35 Z" fill="white" opacity="0.9"/>
            <defs>
              <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
              </linearGradient>
            </defs>
          </svg>
        </div>
        <h1>Focufy Settings</h1>
        <p class="header-subtitle">Configure your focus experience</p>
      </div>
    </header>

    <div id="sessionWarning" class="warning hidden">
      <strong>⚠️ Active Focus Session</strong>
      <p>Settings are blocked during active focus sessions. Please end your session first.</p>
      <button id="endSessionBtn" class="btn btn-danger">End Session</button>
    </div>

    <div id="settingsContent">
      <!-- API Configuration -->
      <section class="settings-section">
        <h2>API Configuration</h2>
        <div id="userApiKeyStatus" class="api-key-status hidden">
          <p class="status-text"></p>
        </div>
        <div class="form-group">
          <p class="help-text" style="color: #667eea; font-weight: 500; margin-bottom: 16px;">
            ✨ <strong>Automatic API Key Generation:</strong> When you sign in with Google, a unique API key is automatically created for you. No manual setup needed!
          </p>
        </div>
      </section>

      <!-- Always Allow List -->
      <section class="settings-section">
        <h2>Always Allow</h2>
        <p class="section-description">Domains where no elements are blocked. You can paste full URLs (https://example.com) or just the domain (example.com)</p>
        <div class="list-container">
          <div class="input-group">
            <input type="text" id="alwaysAllowInput" placeholder="example.com or https://example.com">
            <button id="addAlwaysAllowBtn" class="btn btn-small">Add</button>
          </div>
          <ul id="alwaysAllowList" class="domain-list"></ul>
        </div>
      </section>

      <!-- Always Block List -->
      <section class="settings-section">
        <h2>Always Block</h2>
        <p class="section-description">Domains where the entire page is blocked. You can paste full URLs (https://example.com) or just the domain (example.com)</p>
        <div class="list-container">
          <div class="input-group">
            <input type="text" id="alwaysBlockInput" placeholder="example.com or https://example.com">
            <button id="addAlwaysBlockBtn" class="btn btn-small">Add</button>
          </div>
          <ul id="alwaysBlockList" class="domain-list"></ul>
        </div>
      </section>

      <!-- Auto-Navigation Features -->
      <section class="settings-section">
        <h2>Smart Navigation</h2>
        <p class="section-description">Automatically navigate to relevant content on search engines</p>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="autoNavigateEnabled">
            <span>Enable Auto-Navigation</span>
          </label>
          <p class="help-text">When enabled, visiting search engines (YouTube, Reddit, Wikipedia, Google) will automatically search for content related to your study goal.</p>
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="learningModeEnabled">
            <span>Enable Learning Mode</span>
          </label>
          <p class="help-text">Tracks your browsing patterns and adapts to your focus. If you dive deep into a subtopic, it will learn and suggest related content.</p>
        </div>
      </section>

      <!-- Focus Coach -->
      <section class="settings-section">
        <h2>Focus Coach</h2>
        <p class="section-description">Chatbot that uses the current page + your learning data to quiz or explain concepts.</p>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="focusCoachEnabled">
            <span>Enable Focus Coach</span>
          </label>
          <p class="help-text">Shows the Coach button on pages. Coach will use Learning Mode data when enabled.</p>
        </div>
      </section>

      <!-- Feature Flags reorganized -->
      <section class="settings-section">
        <h2>Shape the Session</h2>
        <p class="section-description">How your focus sessions are structured</p>
        <div class="flag-item">
          <label class="checkbox-label">
            <input type="checkbox" id="goalDecompositionEnabled">
            <span><strong>Goal Decomposition</strong></span>
          </label>
          <p class="flag-desc">Breaks your goal into small, checkable steps</p>
        </div>
        <div class="flag-item">
          <label class="checkbox-label">
            <input type="checkbox" id="energyModeEnabled">
            <span><strong>Energy-Based Focus Mode</strong></span>
          </label>
          <p class="flag-desc">Adapts sessions to your energy level</p>
        </div>
        <div class="flag-item">
          <label class="checkbox-label">
            <input type="checkbox" id="sessionReflectionEnabled">
            <span><strong>Session Reflection</strong></span>
          </label>
          <p class="flag-desc">One quick question at the end to lock in learning</p>
        </div>
      </section>

      <section class="settings-section">
        <h2>See What’s Really Happening</h2>
        <p class="section-description">Understand your focus patterns over time</p>
        <div class="flag-item">
          <label class="checkbox-label">
            <input type="checkbox" id="focusQualityEnabled">
            <span><strong>Focus Quality Signals</strong></span>
          </label>
          <p class="flag-desc">Shows interruptions, idle time, and a focus score</p>
        </div>
        <div class="flag-item">
          <label class="checkbox-label">
            <input type="checkbox" id="narrativeAnalyticsEnabled">
            <span><strong>Narrative Analytics</strong></span>
          </label>
          <p class="flag-desc">Turns stats into plain-English insights</p>
        </div>
        <div class="flag-item">
          <label class="checkbox-label">
            <input type="checkbox" id="learningFeedEnabled">
            <span><strong>Learning Feed</strong></span>
          </label>
          <p class="flag-desc">Timeline of what you worked on and learned</p>
        </div>
      </section>

      <section class="settings-section">
        <h2>Control Distractions</h2>
        <p class="section-description">How strict Focufy should be during focus</p>
        <div class="flag-item">
          <label class="checkbox-label">
            <input type="checkbox" id="contextualBlockingEnabled">
            <span><strong>Contextual Blocking Rules</strong></span>
          </label>
          <p class="flag-desc">Blocks or allows sites based on your goal</p>
        </div>
        <div class="flag-item">
          <label class="checkbox-label">
            <input type="checkbox" id="pauseTaxEnabled">
            <span><strong>Pause Tax</strong></span>
          </label>
          <p class="flag-desc">Adds a short delay before breaking focus</p>
        </div>
      </section>

      <section class="settings-section">
        <h2>Accountability (Private)</h2>
        <p class="section-description">Commitments only you can see</p>
        <div class="flag-item">
          <label class="checkbox-label">
            <input type="checkbox" id="personalContractsEnabled">
            <span><strong>Personal Contracts</strong></span>
          </label>
          <p class="flag-desc">Private promises you make and track</p>
        </div>
      </section>

      <section class="settings-section">
        <h2>AI & Data</h2>
        <p class="section-description">What runs locally vs with AI</p>
        <div class="flag-item">
          <label class="checkbox-label">
            <input type="checkbox" id="aiFeaturesEnabled">
            <span><strong>AI Features Enabled</strong></span>
          </label>
          <p class="flag-desc">Required for any AI-powered features</p>
        </div>
        <div class="flag-item">
          <label class="checkbox-label">
            <input type="checkbox" id="passiveCoachEnabled">
            <span><strong>Passive Focus Coach</strong></span>
          </label>
          <p class="flag-desc">Explains or quizzes you only when focus drops</p>
        </div>
        <div class="flag-item">
          <label class="checkbox-label">
            <input type="checkbox" id="dataRetentionEnabled">
            <span><strong>Data Retention</strong></span>
          </label>
          <p class="flag-desc">Automatically deletes old session data after X days</p>
          <div class="input-group" style="max-width:240px; margin-top:6px;">
            <label for="dataRetentionDays" class="input-label">Retention Days</label>
            <input type="number" id="dataRetentionDays" min="7" max="365" value="90">
          </div>
        </div>
        <p class="help-text">Data Collection: focus stats and learning data stay on-device unless you explicitly enable AI calls.</p>
        <div class="actions" style="margin-top:12px;">
          <button id="exportDataBtn" class="btn btn-secondary">Export Data (JSON)</button>
          <button id="clearDataBtn" class="btn btn-danger">Clear Data</button>
        </div>
      </section>

      <div class="actions">
        <button id="saveBtn" class="btn btn-primary">Save Settings</button>
        <button id="resetBtn" class="btn btn-secondary">Reset to Defaults</button>
      </div>

      <div id="statusMessage" class="status-message hidden"></div>
    </div>
  </div>

  <script src="settings.js"></script>
</body>
</html>
